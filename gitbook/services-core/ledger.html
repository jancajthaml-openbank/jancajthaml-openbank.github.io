<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Ledger - OpenBank</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Open Banking documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../services-core/index.html"><strong aria-hidden="true">2.</strong> Core Services</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services-core/lake.html"><strong aria-hidden="true">2.1.</strong> Lake</a></li><li class="chapter-item expanded "><a href="../services-core/vault.html"><strong aria-hidden="true">2.2.</strong> Vault</a></li><li class="chapter-item expanded "><a href="../services-core/ledger.html" class="active"><strong aria-hidden="true">2.3.</strong> Ledger</a></li></ol></li><li class="chapter-item expanded "><a href="../services-usecase/index.html"><strong aria-hidden="true">3.</strong> Usecases Services</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../services-usecase/data-warehouse.html"><strong aria-hidden="true">3.1.</strong> Data Warehouse</a></li><li class="chapter-item expanded "><a href="../services-usecase/bco.html"><strong aria-hidden="true">3.2.</strong> Bank Connectors</a></li></ol></li><li class="chapter-item expanded "><a href="../storage/index.html"><strong aria-hidden="true">4.</strong> Storage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../storage/primary.html"><strong aria-hidden="true">4.1.</strong> Primary</a></li><li class="chapter-item expanded "><a href="../storage/secondary.html"><strong aria-hidden="true">4.2.</strong> Secondary</a></li></ol></li><li class="chapter-item expanded "><a href="../api/index.html"><strong aria-hidden="true">5.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../api/graphql.html"><strong aria-hidden="true">5.1.</strong> GraphQL</a></li><li class="chapter-item expanded "><a href="../api/rest.html"><strong aria-hidden="true">5.2.</strong> REST</a></li><li class="chapter-item expanded "><a href="../api/zmtp.html"><strong aria-hidden="true">5.3.</strong> ZMTP</a></li></ol></li><li class="chapter-item expanded "><a href="../misc/license.html"><strong aria-hidden="true">6.</strong> License</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../misc/contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OpenBank</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/jancajthaml-openbank" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ledger"><a class="header" href="#ledger">Ledger</a></h1>
<p>Before we dive into the technical details, let's discuss what a Ledger is and why it is needed?</p>
<p>In value transfer betteween entities A and B (under tenancy T) there needs to be mechanism that orchestrates the transfer.</p>
<p>This mechanism does not hold the value, it validates it, orchestrates it and finalises it. Every value transfer has its unique identifier within linear history, this history can be replayed from beggining and SHOULD result in same transfers if all the participants of those transfers are in the same states as they were in that time.</p>
<p>In short ledger:</p>
<ul>
<li>validates transfer</li>
<li>negotiates transfer with <a href="vault.html">vaults</a></li>
<li>owns concept of transfer of value</li>
<li>has unique id</li>
<li>uses primary storage for persistence</li>
</ul>
<h2 id="transactions"><a class="header" href="#transactions">Transactions</a></h2>
<p>Transactions are used to update <a href="vault.html">vault</a> balances. Ledger is updated by transaction that is recorded in ledger history after the transaction is accepted by all vault included in that transaction. Transactions can be initiated by ledger itself or by another entity.</p>
<p>Transactions are validated by both ledger unit and respective vault units. Every transaction is validated against entity structure (which is defined by vault). If the transaction is valid, negotiation with vaults by each vault promising to accept or give value on their side, if the negotiation is sucessful transaction is committed, otherwise it is rollbacked. If transaction fails in validation or before promising stage is initiated transaction is rejected.</p>
<p>Transactions can be initiated by ledger or by another entity.</p>
<ul>
<li>ledger realise a transaction if vaults can balance out the transaction, i.e. balance of affected vaults is sufficient to cover the transaction</li>
<li>there does not need to be corelation between vault tenancy and ledger tenanct</li>
</ul>
<p>Every transaction is validated by ledger itself and the ledger updates and maintains its own history.</p>
<h2 id="transfer"><a class="header" href="#transfer">Transfer</a></h2>
<p>Transfer is single value transfership between vault A and vault B. Transfers have a unique identifier in context under transaction partition.</p>
<p>All transfers are verified by a number of vault to confirm that the transfer is valid and realisable. Each vault holding part of the balance involved in the transfer. Vaults are identified by their unique identifier.</p>
<p>Transfer is balance changing operation on vault unit. Vault updates its current balances after validation of transfer. If all transfers in transaction are valid, transaction is committed. If any transfer is invalid, whole transaction is rollbacked if there were already some promises, producing auditable event of intent on ledger part, otherwise transaction in rejected.</p>
<p>Transfer is initiated by a ledger rest realised by ledger unit.</p>
<h1 id="ledger-units"><a class="header" href="#ledger-units">Ledger Units</a></h1>
<ul>
<li>is by tenant partitioned unit that contains ledger.</li>
<li>has its unique identifier.</li>
<li>has primary storage that is used by ledger to store its state.</li>
<li>is stateless</li>
<li>sprays workers to realise the transaction workflow.</li>
<li>communicate with vaults in order to realise transfer of value.</li>
<li>participate in transactions, they validate them and if they are valid, they negotiate them with vaults.</li>
<li>are managed by ledger rest.</li>
</ul>
<h1 id="ledger-rest"><a class="header" href="#ledger-rest">Ledger Rest</a></h1>
<p>Ledger rest is the application that manages ledger units and exposes REST API. Ledger rest is stateless.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../services-core/vault.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../services-usecase/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../services-core/vault.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../services-usecase/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
